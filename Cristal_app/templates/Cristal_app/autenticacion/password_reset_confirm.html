{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cristal App | Establecer Nueva Contraseña</title>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <link rel="stylesheet" href="{% static 'adminlte/plugins/fontawesome-free/css/all.min.css' %}">
  <link rel="stylesheet" href="{% static 'adminlte/plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'adminlte/dist/css/adminlte.min.css' %}">
</head>
<body class="hold-transition login-page">
<div class="login-box">
  <div class="login-logo">
    <a href="{% url 'home' %}"><b>Cristal</b>App</a>
  </div>
  <div class="card">
    <div class="card-body login-card-body">
      <p class="login-box-msg">Establece tu nueva contraseña</p>

      {% if validlink %} {# Django envía 'validlink' como True si el token es válido #}
        <form action="" method="post">
          {% csrf_token %}

          {% if form.non_field_errors %}
              <div class="alert alert-danger" role="alert">
                  {% for error in form.non_field_errors %}
                      {{ error }}
                  {% endfor %}
              </div>
          {% endif %}

          <div class="input-group mb-3">
            {{ form.new_password1 }} {# Nueva contraseña #}
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-lock"></span>
              </div>
            </div>
            {% if form.new_password1.errors %}
              <div class="invalid-feedback d-block">
                  {% for error in form.new_password1.errors %}
                      {{ error }}
                  {% endfor %}
              </div>
            {% endif %}
          </div>

          <div class="input-group mb-3">
            {{ form.new_password2 }} {# Confirmar nueva contraseña #}
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-lock"></span>
              </div>
            </div>
            {% if form.new_password2.errors %}
              <div class="invalid-feedback d-block">
                  {% for error in form.new_password2.errors %}
                      {{ error }}
                  {% endfor %}
              </div>
            {% endif %}
          </div>

          <div class="row">
            <div class="col-12">
              <button type="submit" class="btn btn-primary btn-block">Cambiar contraseña</button>
            </div>
          </div>
        </form>
      {% else %}
        <div class="alert alert-danger" role="alert">
          <p>El enlace de reseteo de contraseña no es válido, posiblemente porque ya se ha utilizado. Por favor, solicita un nuevo reseteo de contraseña.</p>
        </div>
        <p class="mt-3 mb-1">
            <a href="{% url 'password_reset' %}">Solicitar nuevo reseteo de contraseña</a>
        </p>
      {% endif %}

      <p class="mt-3 mb-1">
        <a href="{% url 'login' %}">Volver al inicio de sesión</a>
      </p>
    </div>
    </div>
</div>
<script src="{% static 'adminlte/plugins/jquery/jquery.min.js' %}"></script>
<script src="{% static 'adminlte/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'adminlte/dist/js/adminlte.min.js' %}"></script>
</body>
</html>